---
interface Props {
  text: string;
  label?: string;
}

const { text, label = 'Copy' } = Astro.props;
---

<button
  class="copy-button group flex min-h-[44px] items-center gap-2 rounded-md border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-600 hover:border-blue-500 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500/50 active:bg-slate-50 transition-all duration-200"
  data-text={text}
  aria-label={label}
>
  <span class="sr-only">{label}</span>
  <!-- Copy Icon -->
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="16"
    height="16"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    class="opacity-70 group-hover:opacity-100 transition-opacity"
  >
    <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
    <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
  </svg>
  <span>{label}</span>
  
  <!-- Success Feedback (Hidden by default) -->
  <span class="absolute right-0 -top-8 hidden rounded bg-slate-800 px-2 py-1 text-xs text-white opacity-0 transition-opacity duration-300 feedback-tooltip">
    Copied!
  </span>
</button>

<script>
  function setupCopyButtons() {
    const buttons = document.querySelectorAll('.copy-button');
    
    buttons.forEach((button) => {
      button.addEventListener('click', async () => {
        const text = button.getAttribute('data-text');
        if (!text) return;

        try {
          await navigator.clipboard.writeText(text);
          
          // Visual feedback
          const originalContent = button.innerHTML;
          const labelSpan = button.querySelector('span:not(.sr-only, .feedback-tooltip)');
          const icon = button.querySelector('svg');
          
          if (labelSpan) labelSpan.textContent = 'Copied!';
          if (icon) {
            icon.innerHTML = '<polyline points="20 6 9 17 4 12"></polyline>';
            icon.classList.add('text-green-500');
          }
          
          button.classList.add('border-green-500', 'text-green-600', 'bg-green-50');
          button.classList.remove('border-slate-200', 'text-slate-600', 'bg-white');

          setTimeout(() => {
            if (labelSpan) labelSpan.textContent = button.getAttribute('aria-label') || 'Copy';
            if (icon) {
              icon.innerHTML = '<rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>';
              icon.classList.remove('text-green-500');
            }
            button.classList.remove('border-green-500', 'text-green-600', 'bg-green-50');
            button.classList.add('border-slate-200', 'text-slate-600', 'bg-white');
          }, 2000);
          
        } catch (err) {
          console.error('Failed to copy text: ', err);
        }
      });
    });
  }

  // Setup on page load
  setupCopyButtons();

  // Setup on view transitions (if used)
  document.addEventListener('astro:page-load', setupCopyButtons);
</script>
