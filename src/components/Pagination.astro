---
interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl: string;
}

const { currentPage, totalPages, baseUrl } = Astro.props;
const cleanBaseUrl = baseUrl.replace(/\/$/, '');

// Generate pagination items
type Item = { type: 'page'; number: number } | { type: 'ellipsis' };
const items: Item[] = [];

if (totalPages > 1) {
  for (let i = 1; i <= totalPages; i++) {
    if (
      i === 1 ||
      i === totalPages ||
      (i >= currentPage - 1 && i <= currentPage + 1)
    ) {
      items.push({ type: 'page', number: i });
    } else if (
      (i === currentPage - 2 && i > 1) ||
      (i === currentPage + 2 && i < totalPages)
    ) {
      items.push({ type: 'ellipsis' });
    }
  }
}

const prevUrl = currentPage > 2 
  ? `${cleanBaseUrl}/page/${currentPage - 1}` 
  : currentPage === 2 
    ? `${cleanBaseUrl}/` 
    : undefined;

const nextUrl = currentPage < totalPages 
  ? `${cleanBaseUrl}/page/${currentPage + 1}` 
  : undefined;
---

{totalPages > 1 && (
  <nav class="flex items-center justify-center space-x-2 mt-12" aria-label="Pagination">
    {/* Previous Button */}
    {prevUrl ? (
      <a
        href={prevUrl}
        class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-slate-200 bg-white text-slate-600 transition hover:border-blue-500 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
        aria-label="Previous page"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </a>
    ) : (
      <span class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-slate-100 bg-slate-50 text-slate-300 cursor-not-allowed">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </span>
    )}

    {/* Page info (mobile) */}
    <span class="text-sm font-medium text-slate-600 md:hidden">
      Page {currentPage} of {totalPages}
    </span>

    {/* Page Numbers (Desktop) */}
    <div class="hidden space-x-2 md:flex">
      {items.map((item) => {
        if (item.type === 'ellipsis') {
          return <span class="inline-flex h-10 w-10 items-center justify-center text-slate-400">...</span>;
        }

        const page = item.number;
        const isCurrent = page === currentPage;
        const url = page === 1 ? `${cleanBaseUrl}/` : `${cleanBaseUrl}/page/${page}`;

        if (isCurrent) {
          return (
            <span
              class="inline-flex h-10 w-10 items-center justify-center rounded-lg bg-blue-600 text-sm font-medium text-white shadow-sm"
              aria-current="page"
            >
              {page}
            </span>
          );
        }

        return (
          <a
            href={url}
            class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-slate-200 bg-white text-sm font-medium text-slate-600 transition hover:border-blue-500 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            {page}
          </a>
        );
      })}
    </div>

    {/* Next Button */}
    {nextUrl ? (
      <a
        href={nextUrl}
        class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-slate-200 bg-white text-slate-600 transition hover:border-blue-500 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
        aria-label="Next page"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
    ) : (
      <span class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-slate-100 bg-slate-50 text-slate-300 cursor-not-allowed">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </span>
    )}
  </nav>
)}
